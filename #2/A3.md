# A3. 크로스 사이트 스크립팅(XSS)
Cross-Site Scripting (XSS)

## #13 XSS - Stored
- 악의적인 스크립트 코드가 데이터베이스에 저장됨
- 저장된 코드 내용을 확인한 사용자의 PC에 스크립트 코드가 실행되도록 하는 공격

### Blog
게시물에 스크립트 코드를 삽입하여 저장하면 해당 게시물을 확인할 때 스크립트가 동작한다.

### Change Secret
비밀번호 힌트로 스크립트 코드를 입력한 후에 SQL Injection - Login Form/User 문제로 이동하여 로그인을 시도하면 스크립트가 작동하는 것을 확인할 수 있다.

### User-Agent
`User-Agent` 정보에 따라 페이지가 리다이렉션 될 수 있다.  
(모바일의 경우 모바일 웹 페이지로 리다이렉션)

`User_Agent` 값을 스크립트 코드로 변경하여 해당 페이지에 접속하면 스크립트가 작동한다.
관리자의 쿠키를 획득할 수 있을 것으로 생각된다.  
(html special character encoding으로 방어?)

---
## #14 XSS - Reflected
- 취약한 매개변수에 악의적인 HTML 코드를 삽입하는 공격
- HTML 태그로 악의적인 사이트에 연결하거나 악성 파일을 다운로드 하도록 유도

### GET
스크립트 코드가 URL에 삽입되어 요청이 전달되고 실행되기 때문에 해당 URL로 접속을 시도하면 스크립트가 작동하게 된다.

### POST
POST 방식은 변수가 Body에 삽입되어 전달되기 때문에 이것 또한 변수값을 스크립트 코드로 바꿔 요청을 전달하면 스크립트가 작동하게 된다.

### JSON
입력창에 스크립트 태그를 닫아주고 다시 실행하고자 하는 스크립트 코드를 입력한다.
그러면 검색값은 없는 상태로 스크립트가 끝나고 내가 입력한 스크립트도 실행된 다음에, 나머지 뒷부분은 스크립트 문이 정상적으로 구성되어 있지 않기 때문에 텍스트로 출력되는 것을 확인할 수 있다.

### AJAX
입력창에 값을 입력하면 2-1 파일이 실시간으로 `title` 변수값을 2-2 파일로 다시 요청을 보내는 것을 확인할 수 있다.
`title` 값을 스크립트 코드로 대체하여 2-1이 아닌 2-2 파일로 직접 요청을 보내면 스크립트가 작동하게 된다.

**(Medium)** 부터는 헤더에 JSON 형태라고 명시해주기 때문에 데이터로 인식하고 스크립트를 실행하지 않는다.
(`img` 태그는 이미지 데이터로 처리하기 때문에 태그가 작동하는 것?)  
이미지 출력에 문제가 있는 경우에 실행되는 `onerror` 속성에 스크립트 코드를 삽입하면 스크립트가 실행된다.

### Eval
URL을 보면 변수로 함수가 전달되는 것을 볼 수 있다.
`eval` 함수는 스크립트를 실행시킬 수 있기 때문에 XSS 취약점이 존재한다.
`Date` 함수 대신에 `eval` 함수에 스크립트 코드를 포함하여 요청을 전달하면 스크립트가 작동하게 된다.

#### (high)
`Date` 함수가 아닌 값이 입력되면 오류를 출력시킨다.
그런데 입력과 상관없이 `Date` 함수를 실행시킬 수 있도록 코드를 작성하면 되는 것이 아닌가하는 생각이 든다.

### phpMyAdmin
(CVE-2010-4480)  
phpMyAdmin에서 `error.php`라는 파일에 취약점이 존재한다.
그래서 `type`과 `error`라는 변수에 값을 전달하면 페이지에 입력한 값이 그대로 출력되는 것을 볼 수 있다.

BBCode 형식으로 URL 부분에 스크립트로 작성된 파일의 위치를 입력하면 스크립트가 실행된다.

`[a@url@page]click[/a]` -> URL 위치로 이동하는 `click`이라는 이름의 링크가 출력된다.(`<a>` 태그와 비슷해보임)

신뢰할 수 있는 페이지의 오류 페이지로 위장하여 해킹을 시도하는 시나리오가 가능하다.

### PHP_SELF
`PHP_SELF`는 자기 자신을 가리키고 있는 서버 변수이다.
그렇기 때문에 소스코드를 보면 `submit`을 할 때 `action`을 자기 자신에게 하게 되는 것을 확인할 수 있다.
그래서 해당 페이지로 요청을 보낼 때 스크립트 코드를 삽입할 수 있는 취약점이 존재한다는 것을 예상할 수 있다.
따옴표와 `form` 태그를 닫아준 후에 스크립트 코드를 삽입하여 요청을 보내면 스크립트가 작동하게 된다.

### HREF
이름 뒤에 `onmouseover`와 같은 속성을 사용하여 스크립트를 동작시킬 수 있다.

`alert`와 같은 간단한 스크립트가 삽입되어 동작하는 것을 확인한 후에는 어떤 방법을 통해 서버로부터 데이터를 탈취할 수 있는지를 알아야 한다.

*(얕은 개념만 정리되어 있기 때문에 살 붙이기가 반드시 필요)*
