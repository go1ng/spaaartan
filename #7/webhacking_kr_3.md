# Webhacking.kr
*150 Points*

*일주일 간 삽질한 기록*

## #19
`admin`을 입력할 수 있어야 할 것 같은 문제인데 막혀있다. 이것을 제외한 다른 단어를 입력하면 정상적으로 로그인이 가능하다. 5글자까지만 입력 가능한 것이 힌트인 느낌이다.

Burp Suite로 만지작거리다가 `admin`을 그대로 입력하지 않고, 단어 중간에 `%00`과 같은 URL 인코딩 문자를 삽입하여 필터링을 무시해보기로 했다. 결과는 정상적으로 로그인이 되어 문제를 풀 수 있었다.

*(사이트 리뉴얼 되기 전에는 로그아웃이 잘 됐던 걸로 기억하는데, 이제는 쿠키를 지우지 않으면 로그아웃이 되지 않는다.)*

---
## #25*
어떤 디렉토리의 내용을 확인할 수 있고, URL을 보면 파일명을 입력할 수 있게 되어 있다. `flag` 파일을 보면 플래그는 코드 안에 있다는 내용이 출력된다. `?file=hello`와 같은 형태로 파일 확장자 없이 입력해야 내용이 출력되는 것으로 보아, 뒤에 `.php`를 자동으로 붙여주기 때문에 Command Injection이 가능할 것 같지는 않았다.

---
## #27*
```php
<?php
  if($_GET['no']){
  $db = dbconnect();
  if(preg_match("/#|select|\(| |limit|=|0x/i",$_GET['no'])) exit("no hack");
  $r=mysqli_fetch_array(mysqli_query($db,"select id from chall27 where id='guest' and no=({$_GET['no']})")) or die("query error");
  if($r['id']=="guest") echo("guest");
  if($r['id']=="admin") solve(27); // admin's no = 2
}
?>
```
`#`이 필터링되어 있어서 괄호를 주석처리 하기 위해 `--`, `;%00` 같은 것들을 시도해봤는데 불가능해서 닫는 소괄호를 무시할 수 없었다. 여는 소괄호도 필터링되어 있어서 Hex 값으로 넣어보려고 `0x` 사이에 `\`를 넣고 `(`를 인코딩해서 시도해봤지만, Hex 값으로 인식하지 못해서인지 괄호를 적당히 무시할 수도 없었다.

다시 보니 문제를 다 풀어놓고 헤매고 있었다. 위에 언급했던 것처럼 분명 괄호도 막고 공격 쿼리 전체를 입력하고 나서 주석을 다 확인해봤는데, 테스트를 잘못했는지 오타가 났는지는 몰라도 다시 확인해보니 `;%00`이 먹혔다.

*(정말 너무 힘 빠진다.)*

---
## #31*
```php
$port = rand(10000,10100);
$socket = fsockopen($_GET['server'],$port,$errno,$errstr,3) or die("error : {$errstr}");
```
포트번호가 해당 범위에서 랜덤으로 결정되고 서버에 접속을 시도한다. 열려있는 포트를 확인하고 접속을 시도해봐야 할 것 같아서 nmap으로 확인해봤지만 모든 포트가 필터링되어 있었다. 

문제에 나와 있는 PHP 코드를 활용해서 해당 범위의 포트에 다 접속해봤는데 전부 오류가 발생했다. 타임아웃 시간을 작게 줘서 그런 건지, 이렇게 접근하는 것이 아닌지 모르겠다.

---
## #32*
사용자를 클릭하면 투표가 되어 오른쪽의 투표수가 올라간다. 다시 시도해보면 이미 투표를 했다는 알림이 뜬다. 쿠키를 살펴보니 `vote_check` 라는 이름의 쿠키값이 존재했다. 이것을 삭제한 후 다시 투표를 해보면 정상적으로 투표수가 오르는 것을 확인할 수 있었다. 1위 사용자의 투표수가 100에 근접해서 저 숫자를 넘기면 무슨 일이 일어날까 싶어서 시도해봤지만 아무런 변화도 없었다.

다른 날에 다시 접속해보니까 전에 봤던 사용자의 투표수가 줄어있는 것이 보였다. 그래서 투표수를 조작하면 해결할 수 있지 않을까 생각해봤는데, 클릭한 사용자의 ID가 `Hit`이라는 변수로 전달되기 때문에 감소시키는 방법이 떠오르지 않았다.

위에서 다른 사람 투표수를 100으로 만들고 아무 반응도 없길래 설마 나 자신을 100으로 만드는 건 아닐 거라고 그냥 넘어갔었는데 진짜였다. 쿠키가 재생성되지 않도록 금지시킨 후에 내 ID를 100으로 만드니까 문제가 풀렸다.

*(겁 먹지 말고 생각난 거는 다 해보기)*

---
## #47*
메일 전송 버튼을 눌러보니 출력되는 내용이 마치 명령어로 통신하는 느낌이 들어서 검색을 해보니까 SMTP라는 것을 확인할 수 있었다. 클라이언트가 메일에 플래그를 보내긴 하는데 수신자를 나 자신으로 할 수가 없어서 고민이 되었다.

---
## #58
페이지 타이틀이 USER Console이라서 리눅스 커맨드 이것저것을 입력해봤는데 먹히는 게 ls밖에 없었다. 혹시나 해서 `flag`를 입력해보니까 어드민만 확인할 수 있다는 오류가 출력되었다. 그래서 페이지 소스 코드를 확인해봤다.

```js
$(function () {
  var username = "guest";
  var socket = io();
  $('form').submit(function(e){
    e.preventDefault();
    socket.emit('cmd',username+":"+$('#m').val());
    $('#m').val('');
    return false;
  });
  socket.on('cmd', function(msg){
    $('#messages').append($('<li>').text(msg));
    });
});
```
커맨드가 입력되는 것으로 보이는 `socket.emit()` 함수를 검색해봤다. **Node.js** 소켓 관련 내용을 읽어보니 `socket.emit()`은 이벤트를 보내고, `socket.on()`은 이벤트를 받는 함수라는 것을 알 수 있었다.

`username`이 `guest`니까 `admin`이 `flag`라는 명령어를 입력하는 요청을 보내면 될 것이라고 판단하였다. 그래서 개발자 도구 콘솔에서 위의 스크립트를 조금 수정하여 아래와 같이 입력해봤더니 플래그가 출력되었다.

```js
var socket = io();
socket.emit('cmd',"admin:flag");
socket.on('cmd', function(msg){
	$('#messages').append($('<li>').text(msg));
});
```